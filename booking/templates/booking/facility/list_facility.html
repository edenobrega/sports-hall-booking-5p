{% extends "base.html" %}
{% load static %}

{% block content %}
{% csrf_token %}
<link rel="stylesheet" type="text/css" href="{% static 'css/list_facility.css' %}">
<script
src="https://code.jquery.com/jquery-3.6.0.min.js"
integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4="
crossorigin="anonymous"></script>

<main>
    <table>
        <tr>
            <th>Admin</th>
            <th>Name</th>
            <th>Postcode</th>
            <th>Address</th>
            <th>Indoor</th>
            <th>Email</th>
            <th>Phone</th>
            <th>Tags</th>
            <th>Image</th>
            <th>Modify Facility</th>
            <th>Modify Tags</th>
            <th>Modify Slots</th>
            <th>View Bookings</th>
            <th>Delete Facility</th>
        </tr>

        {% for d in data %}
            <tr>
                <td>{{d.0.admin}}</td>
                <td>{{d.0.name}}</td>
                <td>{{d.0.postcode}}</td>
                <td>{{d.0.address}}</td>
                <td>{{d.0.indoor}}</td>
                <td>{{d.0.contact_email}}</td>
                <td>{{d.0.contact_phone}}</td>
                <td>
                    {% for t in d.1 %}
                    <span>{{t.tag_id}}</span>
                    {% endfor %}
                </td>
                <td><img src="{{d.0.image}}" /></td>
                <td><a href="{% url 'modify_facility' d.0.id %}">Modify</a></td>
                <td><a href="{% url 'modify_facility_tags' d.0.id %}">Modify</a></td>
                <td><a href="{% url 'modify_slots' d.0.id %}">Modify</a></td>
                <td><a href="{% url 'list_facility_bookings' d.0.id%}">View</a></td>
                <td><a href="#" onclick="deleteFacility({{d.0.id}})">Delete</a></td>
            </tr>
        {% endfor %}
    </table>    

    <div class="create-parent">
        <a href="create">Create New</a>        
    </div>
</main>
<script>
    function deleteFacility(facilityId){
        $.ajax({
            type: "POST",
            url: "/facility/",
            data:{ Data:facilityId },
            headers:{
                'X-CSRFToken': document.querySelector('[name=csrfmiddlewaretoken]').value
            },
            complete: window.location.replace("/")
        }); 
    }
</script>
{% endblock %}